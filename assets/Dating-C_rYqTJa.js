import{_ as S,r,v as F,c as y,d as g,A as H,C as V,n as A,i as E,w as _,j as x,b as q,p as G,D as U,E as J,x as I,G as K,e as m,g as T,F as Q,h as W,y as O,B as P,k as Z}from"./main-Cko-RMe4.js";import{u as ee}from"./dating-CKDPxXej.js";import{C as te}from"./CardContent-BTUaB2ZS.js";import{M as ne}from"./MobileHeader-CqlrEW7c.js";import"./Chip-DNP4HKP_.js";import"./Image-DMV8r9Gc.js";const ae={__name:"CardSwipe",props:{swipe:{type:Boolean,default:!0},swipeThreshold:{type:Number,default:.9},distanceThreshold:{type:Number,default:200},angleThreshold:{type:Number,default:30},rotationMultiplier:{type:Number,default:20},maxRotationAngle:{type:Number,default:50},clickDelay:{type:Number,default:230},moveThreshold:{type:Number,default:7}},emits:["swipe-left","swipe-right","click"],setup(f,{emit:u}){const e=f,c=u,o=r(!1),d=r(!1),k=r(null),l=r("idle"),p=r({x:0,y:0}),v=r({x:0,y:0}),a=r(0),s=r(null),b=r(0);let i=null,h=0;const L=F(()=>{if(!o.value&&!d.value)return{transform:"translate(0, 0) rotate(0deg)",transition:"transform 0.2s ease-out"};const t=v.value.x-p.value.x,n=v.value.y-p.value.y,w=Math.min(t*e.rotationMultiplier/500,e.maxRotationAngle);return o.value?{transform:`translate(${t}px, ${n}px) rotate(${w}deg)`,animation:"0.5s fade-out ease",pointerEvents:"none",opacity:0}:(b.value=Math.min(Math.abs(t)/e.distanceThreshold,1),{transform:`translate(${t}px, ${n}px) rotate(${w}deg)`,transition:"none"})});function X(){c(k.value)}function M(t){if(!e.swipe||o.value)return;const n=C(t);p.value=n,v.value=n,a.value=Date.now(),l.value="waiting",t.type==="touchstart"&&t.preventDefault(),i=setTimeout(()=>{l.value==="waiting"&&$()},e.clickDelay)}function B(t){if(!e.swipe||o.value)return;const n=C(t);v.value=n,l.value==="waiting"?Math.sqrt(Math.pow(n.x-p.value.x,2)+Math.pow(n.y-p.value.y,2))>e.moveThreshold&&(clearTimeout(i),$()):l.value==="dragging"&&Y()}function D(t){if(!e.swipe||o.value)return;const n=C(t);v.value=n,l.value==="waiting"?(clearTimeout(i),z(t)):l.value==="dragging"&&j(),N()}function R(){i&&clearTimeout(i),N()}function $(){l.value="dragging",d.value=!0,s.value=null}function Y(){const t=v.value.x-p.value.x;s.value=t>0?"right":"left"}function j(){const t=v.value.x-p.value.x,n=Date.now()-a.value,w=Math.abs(t)/n;(Math.abs(t)>e.distanceThreshold||w>e.swipeThreshold)&&(s.value=t>0?"right":"left",o.value=!0,k.value=s.value==="right"?"swipe-right":"swipe-left")}function z(t){const n=Date.now(),w=C(t);n-h<300||(h=n,c("click",w))}function N(){d.value=!1,l.value="idle",s.value=null,b.value=0}function C(t){if(t.type.includes("touch")){const n=t.touches?.[0]||t.changedTouches?.[0];return n?{x:n.clientX,y:n.clientY}:{x:0,y:0}}return{x:t.clientX,y:t.clientY}}return(t,n)=>(g(),y("div",{class:A(["card-swipe",{swiping:d.value}]),onAnimationend:X,onMousedownPassive:M,onTouchstartPassive:M,onMousemovePassive:B,onTouchmovePassive:B,onMouseup:D,onMouseleave:D,onTouchend:D,onTouchcancel:R,style:V(e.swipe?L.value:null)},[H(t.$slots,"default",{},void 0,!0)],38))}},oe=S(ae,[["__scopeId","data-v-2e5c74b3"]]),se={__name:"CardDating",props:{user:Object,swipe:Boolean,done:Boolean,like:Boolean},emits:["open","close"],setup(f,{emit:u}){const e=u,c=f,o=r(!1);function d(){o.value=!0,e("open")}function k(){o.value=!1,e("close")}return(l,p)=>(g(),E(oe,{swipe:!o.value&&c.swipe,class:A(["card-dating",{open:!f.done&&o.value,like:f.done&&f.like,dislike:f.done&&!f.like}])},{default:_(()=>[x(te,{user:c.user,open:o.value&&!c.done,onOpen:d,onClose:k},null,8,["user","open"])]),_:1},8,["swipe","class"]))}},le=S(se,[["__scopeId","data-v-b20546b2"]]),ie={class:"col"},re={key:0,class:"col flex",id:"noselect"},ue={key:1,class:"dating-stack"},ce={key:2,class:"col flex",id:"noselect"},de={__name:"Dating",setup(f){const u=q();G();const e=ee(),c=r(!1);function o(){c.value=!0,u.components.navbar.show=!1}function d(){c.value=!1,u.components.navbar.show=!0}function k(){e.likeCurrent()}function l(){e.dislikeCurrent()}function p(){d();const a=e.data[e.data.length-1];a.swipe=!1,a.like=!0,a.done=!0,setTimeout(e.likeCurrent,300)}function v(){d();const a=e.data[e.data.length-1];a.swipe=!1,a.like=!1,a.done=!0,setTimeout(e.dislikeCurrent,300)}return U(async()=>{if(u.mode.mock){e.data=J();return}e.filterLoad(),e.data.length<2&&await e.fetch()}),(a,s)=>{const b=K("Icon-Search-Normal");return g(),y("div",ie,[x(ne,{title:a.$t("pages.dating.title")},{default:_(()=>[x(b,{onClick:s[0]||(s[0]=i=>a.$router.push("/dating/filter")),width:20,height:20,color:"white",style:{margin:"auto"}})]),_:1},8,["title"]),m(u).state.isOnline?m(e).data.length>0?(g(),y("div",ue,[(g(!0),y(Q,null,W(m(e).data,(i,h)=>I((g(),E(le,{style:{position:"absolute"},class:"flex",swipe:h==m(e).data.length-1||h==m(e).data.length-2,key:i.id,user:i,like:i.like,done:i.done,onOpen:o,onClose:d,onSwipeLeft:l,onSwipeRight:k},null,8,["swipe","user","like","done"])),[[O,h==m(e).data.length-1||h==m(e).data.length-2]])),128))])):(g(),y("div",ce,[...s[2]||(s[2]=[T("div",{style:{margin:"auto","text-align":"center",color:"var(--color-gray-500)"}},[T("p",null,"На этом пока что всё"),T("p",null,"Попробуйте позже")],-1)])])):(g(),y("div",re,[...s[1]||(s[1]=[T("div",{style:{margin:"auto","text-align":"center",color:"var(--color-gray-500)"}},[T("p",null,"No network connection")],-1)])])),I(x(Z,null,{default:_(()=>[x(P,{icon:"Icon-Sadcore",text:a.$t("button.dislike"),onClick:v,class:"flex"},null,8,["text"]),x(P,{icon:"Icon-Heart",text:a.$t("button.like"),onClick:p,class:"flex"},null,8,["text"])]),_:1},512),[[O,c.value&&!m(u).components.navbar.show&&m(u).state.isOnline]])])}}},we=S(de,[["__scopeId","data-v-3abc027e"]]);export{we as default};
