import{_ as Ae,G as $,r as k,H as ye,E as Ie,c as F,d as M,f as Oe,F as Me,h as Pe,$ as Le,x as Ce,i as be,g as G,j as Fe,C as Se,n as ke,y as je,M as _e,m as Xe,v as Ve}from"./main-twFbSp79.js";import{I as fe}from"./Image-BFp4Sj8k.js";import{I as We}from"./InputModal-vEvh1LI9.js";/*!
 * Compressor.js v1.2.1
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-02-28T14:09:41.732Z
 */function he(r,t){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(r);t&&(e=e.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),a.push.apply(a,e)}return a}function _(r){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?he(Object(a),!0).forEach(function(e){He(r,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):he(Object(a)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(a,e))})}return r}function Ye(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function me(r,t){for(var a=0;a<t.length;a++){var e=t[a];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,we(e.key),e)}}function ze(r,t,a){return t&&me(r.prototype,t),a&&me(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r}function He(r,t,a){return t=we(t),t in r?Object.defineProperty(r,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[t]=a,r}function X(){return X=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(r[e]=a[e])}return r},X.apply(this,arguments)}function Ge(r,t){if(typeof r!="object"||r===null)return r;var a=r[Symbol.toPrimitive];if(a!==void 0){var e=a.call(r,t);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function we(r){var t=Ge(r,"string");return typeof t=="symbol"?t:String(t)}var Te={exports:{}};(function(r){typeof window>"u"||(function(t){var a=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,e=t.Blob&&(function(){try{return!!new Blob}catch{return!1}})(),i=e&&t.Uint8Array&&(function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}})(),o=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,v=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,h=(e||o)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(c){var f,d,g,y,b,n,B,T,x;if(f=c.match(v),!f)throw new Error("invalid data URI");for(d=f[2]?f[1]:"text/plain"+(f[3]||";charset=US-ASCII"),g=!!f[4],y=c.slice(f[0].length),g?b=atob(y):b=decodeURIComponent(y),n=new ArrayBuffer(b.length),B=new Uint8Array(n),T=0;T<b.length;T+=1)B[T]=b.charCodeAt(T);return e?new Blob([i?B:n],{type:d}):(x=new o,x.append(n),x.getBlob(d))};t.HTMLCanvasElement&&!a.toBlob&&(a.mozGetAsFile?a.toBlob=function(c,f,d){var g=this;setTimeout(function(){d&&a.toDataURL&&h?c(h(g.toDataURL(f,d))):c(g.mozGetAsFile("blob",f))})}:a.toDataURL&&h&&(a.msToBlob?a.toBlob=function(c,f,d){var g=this;setTimeout(function(){(f&&f!=="image/png"||d)&&a.toDataURL&&h?c(h(g.toDataURL(f,d))):c(g.msToBlob(f))})}:a.toBlob=function(c,f,d){var g=this;setTimeout(function(){c(h(g.toDataURL(f,d)))})})),r.exports?r.exports=h:t.dataURLtoBlob=h})(window)})(Te);var ve=Te.exports,Ne=function(t){return typeof Blob>"u"?!1:t instanceof Blob||Object.prototype.toString.call(t)==="[object Blob]"},de={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},$e=typeof window<"u"&&typeof window.document<"u",U=$e?window:{},V=function(t){return t>0&&t<1/0},qe=Array.prototype.slice;function K(r){return Array.from?Array.from(r):qe.call(r)}var Ke=/^image\/.+$/;function q(r){return Ke.test(r)}function Je(r){var t=q(r)?r.substr(6):"";return t==="jpeg"&&(t="jpg"),".".concat(t)}var Be=String.fromCharCode;function Qe(r,t,a){var e="",i;for(a+=t,i=t;i<a;i+=1)e+=Be(r.getUint8(i));return e}var Ze=U.btoa;function ge(r,t){for(var a=[],e=8192,i=new Uint8Array(r);i.length>0;)a.push(Be.apply(null,K(i.subarray(0,e)))),i=i.subarray(e);return"data:".concat(t,";base64,").concat(Ze(a.join("")))}function et(r){var t=new DataView(r),a;try{var e,i,o;if(t.getUint8(0)===255&&t.getUint8(1)===216)for(var v=t.byteLength,h=2;h+1<v;){if(t.getUint8(h)===255&&t.getUint8(h+1)===225){i=h;break}h+=1}if(i){var c=i+4,f=i+10;if(Qe(t,c,4)==="Exif"){var d=t.getUint16(f);if(e=d===18761,(e||d===19789)&&t.getUint16(f+2,e)===42){var g=t.getUint32(f+4,e);g>=8&&(o=f+g)}}}if(o){var y=t.getUint16(o,e),b,n;for(n=0;n<y;n+=1)if(b=o+n*12+2,t.getUint16(b,e)===274){b+=8,a=t.getUint16(b,e),t.setUint16(b,1,e);break}}}catch{a=1}return a}function tt(r){var t=0,a=1,e=1;switch(r){case 2:a=-1;break;case 3:t=-180;break;case 4:e=-1;break;case 5:t=90,e=-1;break;case 6:t=90;break;case 7:t=90,a=-1;break;case 8:t=-90;break}return{rotate:t,scaleX:a,scaleY:e}}var at=/\.\d*(?:0|9){12}\d*$/;function pe(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return at.test(r)?Math.round(r*t)/t:r}function S(r){var t=r.aspectRatio,a=r.height,e=r.width,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",o=V(e),v=V(a);if(o&&v){var h=a*t;(i==="contain"||i==="none")&&h>e||i==="cover"&&h<e?a=e/t:e=a*t}else o?a=e/t:v&&(e=a*t);return{width:e,height:a}}function rt(r){for(var t=K(new Uint8Array(r)),a=t.length,e=[],i=0;i+3<a;){var o=t[i],v=t[i+1];if(o===255&&v===218)break;if(o===255&&v===216)i+=2;else{var h=t[i+2]*256+t[i+3],c=i+h+2,f=t.slice(i,c);e.push(f),i=c}}return e.reduce(function(d,g){return g[0]===255&&g[1]===225?d.concat(g):d},[])}function it(r,t){var a=K(new Uint8Array(r));if(a[2]!==255||a[3]!==224)return r;var e=a[4]*256+a[5],i=[255,216].concat(t,a.slice(4+e));return new Uint8Array(i)}var nt=U.ArrayBuffer,N=U.FileReader,O=U.URL||U.webkitURL,ot=/\.\w+$/,lt=U.Compressor,xe=(function(){function r(t,a){Ye(this,r),this.file=t,this.exif=[],this.image=new Image,this.options=_(_({},de),a),this.aborted=!1,this.result=null,this.init()}return ze(r,[{key:"init",value:function(){var a=this,e=this.file,i=this.options;if(!Ne(e)){this.fail(new Error("The first argument must be a File or Blob object."));return}var o=e.type;if(!q(o)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!O||!N){this.fail(new Error("The current browser does not support image compression."));return}nt||(i.checkOrientation=!1,i.retainExif=!1);var v=o==="image/jpeg",h=v&&i.checkOrientation,c=v&&i.retainExif;if(O&&!h&&!c)this.load({url:O.createObjectURL(e)});else{var f=new N;this.reader=f,f.onload=function(d){var g=d.target,y=g.result,b={},n=1;h&&(n=et(y),n>1&&X(b,tt(n))),c&&(a.exif=rt(y)),h||c?!O||n>1?b.url=ge(y,o):b.url=O.createObjectURL(e):b.url=y,a.load(b)},f.onabort=function(){a.fail(new Error("Aborted to read the image with FileReader."))},f.onerror=function(){a.fail(new Error("Failed to read the image with FileReader."))},f.onloadend=function(){a.reader=null},h||c?f.readAsArrayBuffer(e):f.readAsDataURL(e)}}},{key:"load",value:function(a){var e=this,i=this.file,o=this.image;o.onload=function(){e.draw(_(_({},a),{},{naturalWidth:o.naturalWidth,naturalHeight:o.naturalHeight}))},o.onabort=function(){e.fail(new Error("Aborted to load the image."))},o.onerror=function(){e.fail(new Error("Failed to load the image."))},U.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(U.navigator.userAgent)&&(o.crossOrigin="anonymous"),o.alt=i.name,o.src=a.url}},{key:"draw",value:function(a){var e=this,i=a.naturalWidth,o=a.naturalHeight,v=a.rotate,h=v===void 0?0:v,c=a.scaleX,f=c===void 0?1:c,d=a.scaleY,g=d===void 0?1:d,y=this.file,b=this.image,n=this.options,B=document.createElement("canvas"),T=B.getContext("2d"),x=Math.abs(h)%180===90,D=(n.resize==="contain"||n.resize==="cover")&&V(n.width)&&V(n.height),A=Math.max(n.maxWidth,0)||1/0,R=Math.max(n.maxHeight,0)||1/0,E=Math.max(n.minWidth,0)||0,I=Math.max(n.minHeight,0)||0,s=i/o,l=n.width,u=n.height;if(x){var m=[R,A];A=m[0],R=m[1];var w=[I,E];E=w[0],I=w[1];var p=[u,l];l=p[0],u=p[1]}D&&(s=l/u);var j=S({aspectRatio:s,width:A,height:R},"contain");A=j.width,R=j.height;var J=S({aspectRatio:s,width:E,height:I},"cover");if(E=J.width,I=J.height,D){var Q=S({aspectRatio:s,width:l,height:u},n.resize);l=Q.width,u=Q.height}else{var Z=S({aspectRatio:s,width:l,height:u}),ee=Z.width;l=ee===void 0?i:ee;var te=Z.height;u=te===void 0?o:te}l=Math.floor(pe(Math.min(Math.max(l,E),A))),u=Math.floor(pe(Math.min(Math.max(u,I),R)));var De=-l/2,Re=-u/2,Ee=l,Ue=u,W=[];if(D){var ae=0,re=0,Y=i,z=o,ie=S({aspectRatio:s,width:i,height:o},{contain:"cover",cover:"contain"}[n.resize]);Y=ie.width,z=ie.height,ae=(i-Y)/2,re=(o-z)/2,W.push(ae,re,Y,z)}if(W.push(De,Re,Ee,Ue),x){var ne=[u,l];l=ne[0],u=ne[1]}B.width=l,B.height=u,q(n.mimeType)||(n.mimeType=y.type);var oe="transparent";y.size>n.convertSize&&n.convertTypes.indexOf(n.mimeType)>=0&&(n.mimeType="image/jpeg");var le=n.mimeType==="image/jpeg";if(le&&(oe="#fff"),T.fillStyle=oe,T.fillRect(0,0,l,u),n.beforeDraw&&n.beforeDraw.call(this,T,B),!this.aborted&&(T.save(),T.translate(l/2,u/2),T.rotate(h*Math.PI/180),T.scale(f,g),T.drawImage.apply(T,[b].concat(W)),T.restore(),n.drew&&n.drew.call(this,T,B),!this.aborted)){var se=function(L){if(!e.aborted){var ue=function(C){return e.done({naturalWidth:i,naturalHeight:o,result:C})};if(L&&le&&n.retainExif&&e.exif&&e.exif.length>0){var ce=function(C){return ue(ve(ge(it(C,e.exif),n.mimeType)))};if(L.arrayBuffer)L.arrayBuffer().then(ce).catch(function(){e.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var P=new N;e.reader=P,P.onload=function(H){var C=H.target;ce(C.result)},P.onabort=function(){e.fail(new Error("Aborted to read the compressed image with FileReader."))},P.onerror=function(){e.fail(new Error("Failed to read the compressed image with FileReader."))},P.onloadend=function(){e.reader=null},P.readAsArrayBuffer(L)}}else ue(L)}};B.toBlob?B.toBlob(se,n.mimeType,n.quality):se(ve(B.toDataURL(n.mimeType,n.quality)))}}},{key:"done",value:function(a){var e=a.naturalWidth,i=a.naturalHeight,o=a.result,v=this.file,h=this.image,c=this.options;if(O&&h.src.indexOf("blob:")===0&&O.revokeObjectURL(h.src),o)if(c.strict&&!c.retainExif&&o.size>v.size&&c.mimeType===v.type&&!(c.width>e||c.height>i||c.minWidth>e||c.minHeight>i||c.maxWidth<e||c.maxHeight<i))o=v;else{var f=new Date;o.lastModified=f.getTime(),o.lastModifiedDate=f,o.name=v.name,o.name&&o.type!==v.type&&(o.name=o.name.replace(ot,Je(o.type)))}else o=v;this.result=o,c.success&&c.success.call(this,o)}},{key:"fail",value:function(a){var e=this.options;if(e.error)e.error.call(this,a);else throw a}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=lt,r}},{key:"setDefaults",value:function(a){X(de,a)}}]),r})();function st(r){return new Promise((t,a)=>{if(!r||!r.type.startsWith("image/")){a(new Error("File not image!"));return}new xe(r,{resize:"cover",quality:.6,width:960,height:1280,mimeType:"image/jpeg",beforeDraw(e,i){e.fillStyle="#000000",e.fillRect(0,0,i.width,i.height),e.filter="grayscale(100%)"},success:e=>t(e),error:e=>a(e)})})}function ut(r){return new Promise((t,a)=>{if(!r||!r.type.startsWith("image/")){a(new Error("File not image!"));return}new xe(r,{resize:"cover",quality:.5,width:128,height:170,mimeType:"image/jpeg",beforeDraw(e,i){e.fillStyle="#000000",e.fillRect(0,0,i.width,i.height),e.filter="grayscale(100%)"},success:e=>t(e),error:e=>a(e)})})}async function ct(r){try{const[t,a]=await Promise.all([ut(r),st(r)]);return{smallImage:t,baseImage:a}}catch(t){return console.error("failed compress image:",t),null}}const ft=["id"],ht=["draggable","onDragstart","onDrop","onMousedown","onTouchstart","onTouchmove","onTouchend"],mt=["onClick"],vt={key:1,class:"empty"},dt=["onChange"],gt=["src"],pt={__name:"Gallery",props:$({disabled:Boolean},{modelValue:{},modelModifiers:{}}),emits:$(["loaded","delete","moved"],["update:modelValue"]),setup(r,{emit:t}){const a=k({show:!1,x:0,y:0,image:null}),e=ye(r,"modelValue"),i=t,o=r,v=Array(4).fill(null);e.value||(e.value=v),e.value&&e.value.forEach((s,l)=>{l<4&&(v[l]=s)});function h(s){e.value?.[s]&&(e.value[s]._local&&(URL.revokeObjectURL(e.value[s].base),URL.revokeObjectURL(e.value[s].small)),e.value[s]=null,i("delete",s))}async function c(s,l){const u=s.target.files[0];if(u)try{const{smallImage:m,baseImage:w}=await ct(u),p={index:l,id:"",base:URL.createObjectURL(w),small:URL.createObjectURL(m),_local:{base:w,small:m},_state:{success:!1,error:!1}};e.value[l]=p,s.target.value="",i("loaded",l)}catch(m){console.error("Error compressing image:",m)}}function f(s,l){const u=parseInt(s.dataTransfer.getData("itemId"));if(e.value[l]==null){e.value[l]=e.value[u],e.value[l].index=l,e.value[u]=null,i("moved",u,l);return}else{let m=e.value.slice(0);const w=m[u],p=m[l];m[l]=w,m[u]=p,m[l].index=l,m[u].index=u,e.value=m,i("moved",u,l)}}let d=0,g=0,y=null,b=null,n=!1;function B(s,l){const u=s.touches[0];d=u.clientX,g=u.clientY,n=!1;const m=document.elementFromPoint(u.clientX,u.clientY);m&&m.closest(".remove")||e.value[l]!==null&&(s.preventDefault(),s.stopImmediatePropagation(),b=setTimeout(()=>{const w=s.touches[0];if(!w)return;const p=Math.abs(w.clientX-d),j=Math.abs(w.clientY-g);p<=10&&j<=10&&(n=!0,y=l,a.value={show:!0,x:w.clientX,y:w.clientY,image:e.value[l].base})},400))}function T(s,l){if(!n){const u=s.touches[0],m=Math.abs(u.clientX-d),w=Math.abs(u.clientY-g);(m>10||w>10)&&(clearTimeout(b),n=!1);return}if(n&&y!==null){s.preventDefault();const u=s.touches[0];a.value.x=u.clientX,a.value.y=u.clientY}}function x(s,l){if(clearTimeout(b),!n)return;const u=s.changedTouches[0],m=document.elementFromPoint(u.clientX,u.clientY);if(a.value.show=!1,m&&m.closest(".rect")){const w=m.closest(".rect"),p=Array.from(document.querySelectorAll(".rect")).indexOf(w);p!==-1&&p!==y&&f({dataTransfer:{getData:()=>y.toString()}},p)}y=null,n=!1}let D=!1;function A(s,l){s.target.closest(".remove")||e.value[l]!==null&&(D=!0,y=l,s.clientX,s.clientY,a.value={show:!0,x:s.clientX,y:s.clientY,image:e.value[l].base},document.addEventListener("mousemove",R),document.addEventListener("mouseup",E),s.preventDefault())}function R(s){D&&(a.value.x=s.clientX,a.value.y=s.clientY)}function E(s){if(!D)return;D=!1,a.value.show=!1;const l=document.elementFromPoint(s.clientX,s.clientY);if(l&&l.closest(".rect")){const u=l.closest(".rect"),m=Array.from(document.querySelectorAll(".rect")).indexOf(u);m!==-1&&m!==y&&f({dataTransfer:{getData:()=>y.toString()}},m)}document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",E),y=null}function I(s,l){if(s.dataTransfer.setData("itemId",l),s.dataTransfer.setDragImage){const u=new fe;u.src=e.value[l].base,s.dataTransfer.setDragImage(u,0,0)}}return(s,l)=>{const u=Ie("Icon-Add");return M(),F("div",{class:ke(["gallery",{disabled:o.disabled}]),id:o.disabled?"noevents":null},[(M(!0),F(Me,null,Pe(e.value,(m,w)=>(M(),F("div",{key:m,class:"rect",draggable:e.value[w]!=null,onDragstart:p=>I(p,w),onDragover:l[0]||(l[0]=Le(()=>{},["prevent"])),onDrop:p=>f(p,w),onMousedown:p=>A(p,w),onTouchstart:p=>B(p,w),onTouchmove:p=>T(p),onTouchend:p=>x(p)},[Ce(G("div",{class:"remove",onClick:p=>h(w)},null,8,mt),[[je,m]]),m?(M(),be(fe,{key:0,blur:"",src:m.base,placeholder:m.small,id:"noevents",style:{position:"absolute",width:"100%",height:"100%","border-radius":"15px"},cover:""},null,8,["src","placeholder"])):(M(),F("div",vt,[Fe(u,{color:"var(--color-gray-400)",style:{margin:"auto"},width:22,height:22}),G("input",{class:"loader",type:"file",onChange:p=>c(p,w),accept:"image/png, image/jpeg"},null,40,dt)]))],40,ht))),128)),a.value.show?(M(),F("div",{key:0,class:"drag-preview",style:Se({left:a.value.x+"px",top:a.value.y+"px"})},[G("img",{src:a.value.image,alt:"Preview"},null,8,gt)],4)):Oe("",!0)],10,ft)}}},Bt=Ae(pt,[["__scopeId","data-v-ea38498d"]]),xt={__name:"InputCity",props:$({textValue:String,textNotValue:{type:String,default:"Укажите город"},showButtonDelete:{type:Boolean,value:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const t=ye(r,"modelValue"),a=r,e=_e(),i=Xe(),o=k(!1),v=k(""),h=k([]),c=k(null),f=Ve({get:()=>v.value,set:n=>{v.value=n,o.value=!1,clearTimeout(c.value),o.value=!0,c.value=setTimeout(d,1e3)}});async function d(){if(v.value.length<2)return;const n=await i.fetchCity(v.value);h.value=n,o.value=!1,clearTimeout(c.value)}function g(n){n&&(t.value={id:n._id,name:n.name,code:n.code},v.value="")}function y(n){t.value!=null&&(t.value=null,v.value="")}const b=()=>{e.open("city",{modelValue:f,values:h,loading:o,showButtonDelete:a.showButtonDelete},{accept:g,cancel:y})};return(n,B)=>(M(),be(We,{placeholder:"Не указано",text:t.value&&a.textValue?a.textValue:a.textNotValue,value:t.value?t.value.name:null,onClick:b},null,8,["text","value"]))}};export{Bt as G,xt as _};
