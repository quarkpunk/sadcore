import{p as H,v as Q,_ as X,a as Y,b as Z,m as ee,q as te,M as le,s as oe,N as ae,r as s,D as ne,c as G,d as w,g as n,j as d,t as b,e as C,I as se,B as $,w as O,f as de,F as ue,h as ie,k as re,T as ce,z as pe,i as ve}from"./main-Cko-RMe4.js";import{C as fe}from"./Chip-DNP4HKP_.js";import{G as me,_ as he}from"./InputCity-DgnTkw-3.js";import{_ as S,I as ge}from"./InputModal-BhIZ-w5B.js";import{T as ye}from"./TextArea-Dga7Cblu.js";import"./Image-DMV8r9Gc.js";function be(){const v=H(),c=Q(()=>v.data?.photos||[]);function T(){const a=[null,null,null,null];return!v.data||!v.data.photos||v.data.photos.length==0||v.data.photos.forEach(l=>{l.index>=0&&l.index<4&&(a[l.index]={...l,_fromBackend:!0})}),a}const x=a=>c.value.filter(l=>!a.some(r=>r&&r.id&&r.id===l.id)),g=a=>a.filter(l=>l&&l._local&&!l.id),h=a=>{const l=[];return c.value.forEach(r=>{const f=a.find(u=>u&&u.id===r.id);f&&f.index!==r.index&&l.push({id:r.id,index_old:r.index,index_new:f.index})}),l},i=a=>({deleted:x(a),new:g(a),moved:h(a)});async function p(a){const{deleted:l,new:r,moved:f}=i(a);try{if(l.length>0){let u=[];for(const m of l)u.push(m.id);await v.deletePhotos(u)}if(f.length>0&&await v.uploadPhotoPositions(f),r.length>0)for(const u of r){const m=new FormData;m.append("image",u._local.base),m.append("image_small",u._local.small),await v.uploadPhoto(u.index,m)}return!0}catch(u){return console.error("save photos: ",u),!1}}return{loadPhotos:T,savePhotos:p,getPhotosDeleted:x,getPhotosNew:g,getPhotosPositionChanges:h,getPhotosAllChanges:i}}const $e={class:"col",style:{height:"0"}},xe={class:"col mobile-safe flex mobile-scroll-view"},ke={class:"col gap-20"},Ve={id:"noselect"},we={id:"noselect"},Ce={class:"col gap-10"},Se={id:"noselect"},Te={class:"col gap-10"},Ee={id:"noselect"},Pe={class:"col gap-10"},Ae={class:"col gap-10"},De={class:"buttons"},Be={key:0,class:"col screen-tags",style:{"box-sizing":"border-box"}},Ie={class:"col flex mobile-safe mobile-scroll-view gap-15"},Ue={id:"noselect",style:{padding:"10px 0px"}},Fe={class:"grid"},Ge={__name:"ProfileEdit",setup(v){const{t:c}=Y(),{loadPhotos:T,savePhotos:x}=be(),g=pe(),h=Z(),i=H(),p=ee(),a=te(),l=le(),r=oe(),f=ae(),u=s(!1),m=s(p.data.ageArray),L=s(p.data.genderArray),M=s(p.data.bodyTypeArray),E=s(p.data.bodyHeightArray),P=s(i.data.info.desc),A=s(i.data.info.name),D=s(i.data.info.city||null),B=s(p.valueFromData(m.value,i.data.info.age)),I=s(i.data.info.gender),U=s(i.data.info.body.type),F=s(p.valueFromData(E.value,i.data.info.body.height)),k=s(p.tagsFromDataSelected(i.data.info.tags||[])),y=s(_()),R=s(5),V=s([]);async function z(){const e={name:A.value,city:D.value,age:p.valueToData(m.value,B.value)|0,gender:I.value,desc:P.value,tags:p.tagsToData(k.value),body:{type:U.value,height:p.valueToData(E.value,F.value)|0}};return await i.update_info(e)}async function j(){const e=await x(V.value),t=await z();return!e||!t?(l.openError(c("status.error")),!1):(await i.fetch(),setTimeout(()=>g.back(),500),l.openInfo(c("status.saved")),!0)}function _(){let e=0;return k.value.forEach(t=>{t.selected&&(e+=1)}),e}function q(e){k.value.forEach(t=>{if(t._id==e){if(!t.selected&&y.value+1>=R.value+1)return;t.selected=!t.selected;return}}),y.value=_()}function W(){f.open("message",{buttonAccept:!0,buttonCancel:!0,text:c("modals.profileLogout"),textAccept:c("button.yes"),textCancel:c("button.cancel"),textDeleteAndReport:null},{accept:async e=>{await a.logout(),r.disconnect(),setTimeout(()=>{g.push("/")},1e3)}})}function J(){f.open("message",{buttonAccept:!0,buttonCancel:!0,text:c("modals.profileDelete"),textAccept:c("button.yes"),textCancel:c("button.cancel"),textDeleteAndReport:null},{accept:async e=>{await i.delete()||(l.openInfo(c("status.error")),console.error("failed delete")),r.disconnect(),l.openInfo(c("status.success")),setTimeout(()=>{g.push("/")},1e3)}})}function K(e){l.openError("Bad image format")}function N(){u.value=!u.value}return ne(()=>{V.value=T()}),(e,t)=>(w(),G("div",$e,[n("div",xe,[n("div",ke,[t[9]||(t[9]=n("br",null,null,-1)),n("h5",Ve,b(e.$t("pages.profileEdit.photos")),1),d(me,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=o=>V.value=o),disabled:!C(h).state.isOnline,style:{height:"550px"},onError:K},null,8,["modelValue","disabled"]),n("h5",we,b(e.$t("pages.profileEdit.general")),1),n("div",Ce,[d(se,{modelValue:A.value,"onUpdate:modelValue":t[1]||(t[1]=o=>A.value=o),placeholder:e.$t("input.name.placeholder")},null,8,["modelValue","placeholder"]),d(S,{"modal-type":"vertical-scroller","modal-title":e.$t("modals.type"),placeholder:e.$t("data.none"),"text-value":e.$t("input.age.value"),"text-not-value":e.$t("input.age.placeholder"),values:m.value,modelValue:B.value,"onUpdate:modelValue":t[2]||(t[2]=o=>B.value=o)},null,8,["modal-title","placeholder","text-value","text-not-value","values","modelValue"]),d(he,{placeholder:e.$t("data.none"),"text-value":e.$t("input.city.value"),"text-not-value":e.$t("input.city.placeholder"),"show-button-delete":!1,modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=o=>D.value=o)},null,8,["placeholder","text-value","text-not-value","modelValue"]),d(S,{icon:"Icon-Gender","modal-type":"radio","modal-title":e.$t("modals.type"),placeholder:e.$t("data.none"),"text-not-value":e.$t("input.gender.placeholder"),values:L.value,modelValue:I.value,"onUpdate:modelValue":t[4]||(t[4]=o=>I.value=o)},null,8,["modal-title","placeholder","text-not-value","values","modelValue"])]),n("h5",Se,b(e.$t("pages.profileEdit.appearance")),1),n("div",Te,[d(S,{icon:"Icon-Body","modal-type":"radio","modal-title":e.$t("modals.type"),placeholder:e.$t("data.none"),"text-not-value":e.$t("input.bodyType.placeholder"),values:M.value,modelValue:U.value,"onUpdate:modelValue":t[5]||(t[5]=o=>U.value=o)},null,8,["modal-title","placeholder","text-not-value","values","modelValue"]),d(S,{icon:"Icon-Ruler","modal-type":"vertical-scroller","modal-title":e.$t("modals.value"),placeholder:e.$t("data.none"),"text-not-value":e.$t("input.bodyHeight.placeholder"),values:E.value,modelValue:F.value,"onUpdate:modelValue":t[6]||(t[6]=o=>F.value=o)},null,8,["modal-title","placeholder","text-not-value","values","modelValue"])]),n("h5",Ee,b(e.$t("pages.profileEdit.other")),1),n("div",Pe,[d(ge,{value:y.value>0?`${y.value} ${e.$t("prefix.pcs")}`:null,text:y.value>0?e.$t("input.tags.value"):e.$t("input.tags.placeholder"),placeholder:e.$t("data.none"),onClick:N},null,8,["value","text","placeholder"]),d(ye,{modelValue:P.value,"onUpdate:modelValue":t[7]||(t[7]=o=>P.value=o),placeholder:e.$t("pages.profileEdit.desc.placeholder"),height:7,maxLength:250,spellcheck:"false"},null,8,["modelValue","placeholder"])]),t[10]||(t[10]=n("div",{style:{height:"50px"}},null,-1)),n("div",Ae,[d($,{onClick:W,text:e.$t("button.logout"),disabled:!C(h).state.isOnline},null,8,["text","disabled"]),d($,{onClick:J,text:e.$t("button.deleteProfile"),type:"error",disabled:!C(h).state.isOnline},null,8,["text","disabled"])]),t[11]||(t[11]=n("br",null,null,-1))])]),n("div",De,[d($,{class:"flex",text:e.$t("button.back"),onClick:t[8]||(t[8]=o=>e.$router.back())},null,8,["text"]),d($,{class:"flex",text:e.$t("button.save"),onClick:j,disabled:!C(h).state.isOnline},null,8,["text","disabled"])]),d(ce,{name:"t-slide-up"},{default:O(()=>[u.value?(w(),G("div",Be,[n("div",Ie,[t[12]||(t[12]=n("br",null,null,-1)),n("h5",Ue,b(e.$t("pages.profileEdit.tags")),1),n("div",Fe,[(w(!0),G(ue,null,ie(k.value,o=>(w(),ve(fe,{key:o._id,text:o.name[e.$i18n.locale],selected:o.selected,onClick:_e=>q(o._id)},null,8,["text","selected","onClick"]))),128))])]),d(re,null,{default:O(()=>[d($,{text:e.$t("button.back"),onClick:N,flex:""},null,8,["text"])]),_:1})])):de("",!0)]),_:1})]))}},ze=X(Ge,[["__scopeId","data-v-a60a0f46"]]);export{ze as default};
