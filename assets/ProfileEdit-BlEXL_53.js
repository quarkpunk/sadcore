import{s as H,z as Q,_ as X,a as Y,b as Z,q as ee,v as te,y as oe,x as le,P as ae,r as n,G as se,d as F,e as V,h as s,k as d,t as b,f as C,I as ne,B as $,w as O,g as de,F as ue,i as re,l as ie,T as ce,n as pe,j as ve}from"./main-B2M20k_z.js";import{C as fe}from"./Chip-Cqh7EHat.js";import{G as me,_ as he}from"./InputCity-DsSqXxba.js";import{_ as S,I as ge}from"./InputModal-C_4U1-lA.js";import{T as ye}from"./TextArea-DWo_qrby.js";function be(){const f=H(),p=Q(()=>f.data?.photos||[]);function T(){const a=[null,null,null,null];return!f.data||!f.data.photos||f.data.photos.length==0||f.data.photos.forEach(o=>{o.index>=0&&o.index<4&&(a[o.index]={...o,_fromBackend:!0})}),a}const k=a=>p.value.filter(o=>!a.some(c=>c&&c.id&&c.id===o.id)),g=a=>a.filter(o=>o&&o._local&&!o.id),u=a=>{const o=[];return p.value.forEach(c=>{const m=a.find(r=>r&&r.id===c.id);m&&m.index!==c.index&&o.push({id:c.id,index_old:c.index,index_new:m.index})}),o},i=a=>({deleted:k(a),new:g(a),moved:u(a)});async function v(a){const{deleted:o,new:c,moved:m}=i(a);try{if(o.length>0){let r=[];for(const h of o)r.push(h.id);await f.deletePhotos(r)}if(m.length>0&&await f.uploadPhotoPositions(m),c.length>0)for(const r of c){const h=new FormData;h.append("image",r._local.base),h.append("image_small",r._local.small),await f.uploadPhoto(r.index,h)}return!0}catch(r){return console.error("save photos: ",r),!1}}return{loadPhotos:T,savePhotos:v,getPhotosDeleted:k,getPhotosNew:g,getPhotosPositionChanges:u,getPhotosAllChanges:i}}const $e={class:"col",style:{height:"0"}},ke={class:"col mobile-safe flex mobile-scroll-view"},we={class:"col gap-20"},xe={id:"noselect"},Ve={id:"noselect"},Ce={class:"col gap-10"},Se={id:"noselect"},Te={class:"col gap-10"},Pe={id:"noselect"},Ee={class:"col gap-10"},Ae={class:"col gap-10"},Be={class:"buttons"},De={key:0,class:"col screen-tags",style:{"box-sizing":"border-box"}},Ie={class:"col flex mobile-safe mobile-scroll-view gap-15"},Ue={id:"noselect",style:{padding:"10px 0px"}},Ge={class:"grid"},Fe={__name:"ProfileEdit",setup(f){const{t:p}=Y(),{loadPhotos:T,savePhotos:k}=be(),g=pe(),u=Z(),i=H(),v=ee(),a=te(),o=oe(),c=le(),m=ae(),r=n(!1),h=n(v.data.ageArray),N=n(v.data.genderArray),R=n(v.data.bodyTypeArray),P=n(v.data.bodyHeightArray),E=n(i.data.info.desc),A=n(i.data.info.name),B=n(i.data.info.city||null),D=n(v.valueFromData(h.value,i.data.info.age)),I=n(i.data.info.gender),U=n(i.data.info.body.type),G=n(v.valueFromData(P.value,i.data.info.body.height)),w=n(v.tagsFromDataSelected(i.data.info.tags||[])),y=n(_()),M=n(5),x=n([]);async function z(){const e={name:A.value,city:B.value,age:v.valueToData(h.value,D.value)|0,gender:I.value,desc:E.value,tags:v.tagsToData(w.value),body:{type:U.value,height:v.valueToData(P.value,G.value)|0}};return await i.update_info(e)}async function j(){u.components.locker.show=!0;const e=await k(x.value),t=await z();return!e||!t?(o.openError(p("status.error")),u.components.locker.show=!1,!1):(await i.fetch(),setTimeout(()=>g.back(),500),o.openInfo(p("status.saved")),u.components.locker.show=!1,!0)}function _(){let e=0;return w.value.forEach(t=>{t.selected&&(e+=1)}),e}function q(e){w.value.forEach(t=>{if(t._id==e){if(!t.selected&&y.value+1>=M.value+1)return;t.selected=!t.selected;return}}),y.value=_()}function W(){m.open("message",{buttonAccept:!0,buttonCancel:!0,text:p("modals.profileLogout"),textAccept:p("button.yes"),textCancel:p("button.cancel"),textDeleteAndReport:null},{accept:async e=>{u.components.locker.show=!0,await a.logout(),c.disconnect(),setTimeout(()=>{u.components.locker.show=!1,g.push("/")},1e3)}})}function J(){m.open("message",{buttonAccept:!0,buttonCancel:!0,text:p("modals.profileDelete"),textAccept:p("button.yes"),textCancel:p("button.cancel"),textDeleteAndReport:null},{accept:async e=>{u.components.locker.show=!0,await i.delete()||(o.openInfo(p("status.error")),console.error("failed delete"),u.components.locker.show=!1),await a.logoutLocal(),c.disconnect(),o.openInfo(p("status.success")),setTimeout(()=>{u.components.locker.show=!1,g.push("/")},1e3)}})}function K(e){o.openError("Bad image format")}function L(){r.value=!r.value}return se(()=>{x.value=T()}),(e,t)=>(V(),F("div",$e,[s("div",ke,[s("div",we,[t[9]||(t[9]=s("br",null,null,-1)),s("h5",xe,b(e.$t("pages.profileEdit.photos")),1),d(me,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=l=>x.value=l),disabled:!C(u).state.isOnline,style:{height:"550px"},onError:K},null,8,["modelValue","disabled"]),s("h5",Ve,b(e.$t("pages.profileEdit.general")),1),s("div",Ce,[d(ne,{modelValue:A.value,"onUpdate:modelValue":t[1]||(t[1]=l=>A.value=l),placeholder:e.$t("input.name.placeholder")},null,8,["modelValue","placeholder"]),d(S,{"modal-type":"vertical-scroller","modal-title":e.$t("modals.type"),placeholder:e.$t("data.none"),"text-value":e.$t("input.age.value"),"text-not-value":e.$t("input.age.placeholder"),values:h.value,modelValue:D.value,"onUpdate:modelValue":t[2]||(t[2]=l=>D.value=l)},null,8,["modal-title","placeholder","text-value","text-not-value","values","modelValue"]),d(he,{placeholder:e.$t("data.none"),"text-value":e.$t("input.city.value"),"text-not-value":e.$t("input.city.placeholder"),"show-button-delete":!1,modelValue:B.value,"onUpdate:modelValue":t[3]||(t[3]=l=>B.value=l)},null,8,["placeholder","text-value","text-not-value","modelValue"]),d(S,{icon:"Icon-Gender","modal-type":"radio","modal-title":e.$t("modals.type"),placeholder:e.$t("data.none"),"text-not-value":e.$t("input.gender.placeholder"),values:N.value,modelValue:I.value,"onUpdate:modelValue":t[4]||(t[4]=l=>I.value=l)},null,8,["modal-title","placeholder","text-not-value","values","modelValue"])]),s("h5",Se,b(e.$t("pages.profileEdit.appearance")),1),s("div",Te,[d(S,{icon:"Icon-Body","modal-type":"radio","modal-title":e.$t("modals.type"),placeholder:e.$t("data.none"),"text-not-value":e.$t("input.bodyType.placeholder"),values:R.value,modelValue:U.value,"onUpdate:modelValue":t[5]||(t[5]=l=>U.value=l)},null,8,["modal-title","placeholder","text-not-value","values","modelValue"]),d(S,{icon:"Icon-Ruler","modal-type":"vertical-scroller","modal-title":e.$t("modals.value"),placeholder:e.$t("data.none"),"text-not-value":e.$t("input.bodyHeight.placeholder"),values:P.value,modelValue:G.value,"onUpdate:modelValue":t[6]||(t[6]=l=>G.value=l)},null,8,["modal-title","placeholder","text-not-value","values","modelValue"])]),s("h5",Pe,b(e.$t("pages.profileEdit.other")),1),s("div",Ee,[d(ge,{value:y.value>0?`${y.value} ${e.$t("prefix.pcs")}`:null,text:y.value>0?e.$t("input.tags.value"):e.$t("input.tags.placeholder"),placeholder:e.$t("data.none"),onClick:L},null,8,["value","text","placeholder"]),d(ye,{modelValue:E.value,"onUpdate:modelValue":t[7]||(t[7]=l=>E.value=l),placeholder:e.$t("pages.profileEdit.desc.placeholder"),height:7,maxLength:250,spellcheck:"false"},null,8,["modelValue","placeholder"])]),t[10]||(t[10]=s("div",{style:{height:"50px"}},null,-1)),s("div",Ae,[d($,{onClick:W,text:e.$t("button.logout"),disabled:!C(u).state.isOnline},null,8,["text","disabled"]),d($,{onClick:J,text:e.$t("button.deleteProfile"),type:"error",disabled:!C(u).state.isOnline},null,8,["text","disabled"])]),t[11]||(t[11]=s("br",null,null,-1))])]),s("div",Be,[d($,{class:"flex",text:e.$t("button.back"),onClick:t[8]||(t[8]=l=>e.$router.back())},null,8,["text"]),d($,{class:"flex",text:e.$t("button.save"),onClick:j,disabled:!C(u).state.isOnline},null,8,["text","disabled"])]),d(ce,{name:"t-slide-up"},{default:O(()=>[r.value?(V(),F("div",De,[s("div",Ie,[t[12]||(t[12]=s("br",null,null,-1)),s("h5",Ue,b(e.$t("pages.profileEdit.tags")),1),s("div",Ge,[(V(!0),F(ue,null,re(w.value,l=>(V(),ve(fe,{key:l._id,text:l.name[e.$i18n.locale],selected:l.selected,onClick:_e=>q(l._id)},null,8,["text","selected","onClick"]))),128))])]),d(ie,null,{default:O(()=>[d($,{text:e.$t("button.back"),onClick:L,flex:""},null,8,["text"])]),_:1})])):de("",!0)]),_:1})]))}},Me=X(Fe,[["__scopeId","data-v-378d0bad"]]);export{Me as default};
