import{p as H,v as K,_ as Q,a as X,b as Y,m as Z,q as ee,L as te,s as le,M as oe,r as n,D as ae,c as _,d as w,g as s,j as d,t as b,e as C,I as se,B as $,w as O,f as ne,F as de,h as ue,k as ie,T as re,z as ce,i as pe}from"./main-FXtvOfZS.js";import{C as ve}from"./Chip-BpkyG-27.js";import{G as fe,_ as me}from"./InputCity-DT2kCGTy.js";import{_ as S,I as he}from"./InputModal-eyHCj1cc.js";import{T as ge}from"./TextArea-CbbcGR9I.js";import"./Image-CgMhDWjt.js";function ye(){const v=H(),c=K(()=>v.data?.photos||[]);function T(){const a=[null,null,null,null];return!v.data||!v.data.photos||v.data.photos.length==0||v.data.photos.forEach(l=>{l.index>=0&&l.index<4&&(a[l.index]={...l,_fromBackend:!0})}),a}const x=a=>c.value.filter(l=>!a.some(r=>r&&r.id&&r.id===l.id)),g=a=>a.filter(l=>l&&l._local&&!l.id),h=a=>{const l=[];return c.value.forEach(r=>{const f=a.find(u=>u&&u.id===r.id);f&&f.index!==r.index&&l.push({id:r.id,index_old:r.index,index_new:f.index})}),l},i=a=>({deleted:x(a),new:g(a),moved:h(a)});async function p(a){const{deleted:l,new:r,moved:f}=i(a);try{if(l.length>0){let u=[];for(const m of l)u.push(m.id);await v.deletePhotos(u)}if(f.length>0&&await v.uploadPhotoPositions(f),r.length>0)for(const u of r){const m=new FormData;m.append("image",u._local.base),m.append("image_small",u._local.small),await v.uploadPhoto(u.index,m)}return!0}catch(u){return console.error("save photos: ",u),!1}}return{loadPhotos:T,savePhotos:p,getPhotosDeleted:x,getPhotosNew:g,getPhotosPositionChanges:h,getPhotosAllChanges:i}}const be={class:"col",style:{height:"0"}},$e={class:"col mobile-safe flex mobile-scroll-view"},xe={class:"col gap-20"},ke={id:"noselect"},Ve={id:"noselect"},we={class:"col gap-10"},Ce={id:"noselect"},Se={class:"col gap-10"},Te={id:"noselect"},Pe={class:"col gap-10"},Ae={class:"col gap-10"},De={class:"buttons"},Ee={key:0,class:"col screen-tags",style:{"box-sizing":"border-box"}},Ie={class:"col flex mobile-safe mobile-scroll-view gap-15"},Be={id:"noselect",style:{padding:"10px 0px"}},Ue={class:"grid"},Fe={__name:"ProfileEdit",setup(v){const{t:c}=X(),{loadPhotos:T,savePhotos:x}=ye(),g=ce(),h=Y(),i=H(),p=Z(),a=ee(),l=te(),r=le(),f=oe(),u=n(!1),m=n(p.data.ageArray),M=n(p.data.genderArray),N=n(p.data.bodyTypeArray),P=n(p.data.bodyHeightArray),A=n(i.data.info.desc),D=n(i.data.info.name),E=n(i.data.info.city||null),I=n(p.valueFromData(m.value,i.data.info.age)),B=n(i.data.info.gender),U=n(i.data.info.body.type),F=n(p.valueFromData(P.value,i.data.info.body.height)),k=n(p.tagsFromDataSelected(i.data.info.tags||[])),y=n(G()),R=n(5),V=n([]);async function z(){const e={name:D.value,city:E.value,age:p.valueToData(m.value,I.value)|0,gender:B.value,desc:A.value,tags:p.tagsToData(k.value),body:{type:U.value,height:p.valueToData(P.value,F.value)|0}};return await i.update_info(e)}async function j(){const e=await x(V.value),t=await z();return!e||!t?(l.openError(c("status.error")),!1):(await i.fetch(),setTimeout(()=>g.back(),500),l.openInfo(c("status.saved")),!0)}function G(){let e=0;return k.value.forEach(t=>{t.selected&&(e+=1)}),e}function q(e){k.value.forEach(t=>{if(t._id==e){if(!t.selected&&y.value+1>=R.value+1)return;t.selected=!t.selected;return}}),y.value=G()}function W(){f.open("message",{buttonAccept:!0,buttonCancel:!0,text:c("modals.profileLogout"),textAccept:c("button.yes"),textCancel:c("button.cancel"),textDeleteAndReport:null},{accept:async e=>{await a.logout(),r.disconnect(),setTimeout(()=>{g.push("/")},1e3)}})}function J(){f.open("message",{buttonAccept:!0,buttonCancel:!0,text:c("modals.profileDelete"),textAccept:c("button.yes"),textCancel:c("button.cancel"),textDeleteAndReport:null},{accept:async e=>{await i.delete()||(l.openInfo(c("status.error")),console.error("failed delete")),await a.logout(),r.disconnect(),l.openInfo(c("status.success")),setTimeout(()=>{g.push("/")},1e3)}})}function L(){u.value=!u.value}return ae(()=>{V.value=T()}),(e,t)=>(w(),_("div",be,[s("div",$e,[s("div",xe,[t[9]||(t[9]=s("br",null,null,-1)),s("h5",ke,b(e.$t("pages.profileEdit.photos")),1),d(fe,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=o=>V.value=o),disabled:!C(h).state.isOnline,style:{height:"550px"}},null,8,["modelValue","disabled"]),s("h5",Ve,b(e.$t("pages.profileEdit.general")),1),s("div",we,[d(se,{modelValue:D.value,"onUpdate:modelValue":t[1]||(t[1]=o=>D.value=o),placeholder:e.$t("input.name.placeholder")},null,8,["modelValue","placeholder"]),d(S,{"modal-type":"vertical-scroller","modal-title":e.$t("modals.type"),placeholder:e.$t("data.none"),"text-value":e.$t("input.age.value"),"text-not-value":e.$t("input.age.placeholder"),values:m.value,modelValue:I.value,"onUpdate:modelValue":t[2]||(t[2]=o=>I.value=o)},null,8,["modal-title","placeholder","text-value","text-not-value","values","modelValue"]),d(me,{placeholder:e.$t("data.none"),"text-value":e.$t("input.city.value"),"text-not-value":e.$t("input.city.placeholder"),"show-button-delete":!1,modelValue:E.value,"onUpdate:modelValue":t[3]||(t[3]=o=>E.value=o)},null,8,["placeholder","text-value","text-not-value","modelValue"])]),s("h5",Ce,b(e.$t("pages.profileEdit.appearance")),1),s("div",Se,[d(S,{icon:"Icon-Gender","modal-type":"radio","modal-title":e.$t("modals.type"),placeholder:e.$t("data.none"),"text-not-value":e.$t("input.gender.placeholder"),values:M.value,modelValue:B.value,"onUpdate:modelValue":t[4]||(t[4]=o=>B.value=o)},null,8,["modal-title","placeholder","text-not-value","values","modelValue"]),d(S,{icon:"Icon-Body","modal-type":"radio","modal-title":e.$t("modals.type"),placeholder:e.$t("data.none"),"text-not-value":e.$t("input.bodyType.placeholder"),values:N.value,modelValue:U.value,"onUpdate:modelValue":t[5]||(t[5]=o=>U.value=o)},null,8,["modal-title","placeholder","text-not-value","values","modelValue"]),d(S,{icon:"Icon-Ruler","modal-type":"vertical-scroller","modal-title":e.$t("modals.type"),placeholder:e.$t("data.none"),"text-not-value":e.$t("input.bodyHeight.placeholder"),values:P.value,modelValue:F.value,"onUpdate:modelValue":t[6]||(t[6]=o=>F.value=o)},null,8,["modal-title","placeholder","text-not-value","values","modelValue"])]),s("h5",Te,b(e.$t("pages.profileEdit.other")),1),s("div",Pe,[d(he,{value:y.value>0?`${y.value} ${e.$t("prefix.pcs")}`:null,text:y.value>0?e.$t("input.tags.value"):e.$t("input.tags.placeholder"),placeholder:e.$t("data.none"),onClick:L},null,8,["value","text","placeholder"]),d(ge,{modelValue:A.value,"onUpdate:modelValue":t[7]||(t[7]=o=>A.value=o),placeholder:e.$t("pages.profileEdit.desc.placeholder"),height:7,maxLength:250,spellcheck:"false"},null,8,["modelValue","placeholder"])]),t[10]||(t[10]=s("div",{style:{height:"50px"}},null,-1)),s("div",Ae,[d($,{onClick:W,text:e.$t("button.logout"),disabled:!C(h).state.isOnline},null,8,["text","disabled"]),d($,{onClick:J,text:e.$t("button.deleteProfile"),type:"error",disabled:!C(h).state.isOnline},null,8,["text","disabled"])]),t[11]||(t[11]=s("br",null,null,-1))])]),s("div",De,[d($,{class:"flex",text:e.$t("button.back"),onClick:t[8]||(t[8]=o=>e.$router.back())},null,8,["text"]),d($,{class:"flex",text:e.$t("button.save"),onClick:j,disabled:!C(h).state.isOnline},null,8,["text","disabled"])]),d(re,{name:"t-slide-up"},{default:O(()=>[u.value?(w(),_("div",Ee,[s("div",Ie,[t[12]||(t[12]=s("br",null,null,-1)),s("h5",Be,b(e.$t("pages.profileEdit.tags")),1),s("div",Ue,[(w(!0),_(de,null,ue(k.value,o=>(w(),pe(ve,{key:o._id,text:o.name[e.$i18n.locale],selected:o.selected,onClick:_e=>q(o._id)},null,8,["text","selected","onClick"]))),128))])]),d(ie,null,{default:O(()=>[d($,{text:e.$t("button.back"),onClick:L,flex:""},null,8,["text"])]),_:1})])):ne("",!0)]),_:1})]))}},Re=Q(Fe,[["__scopeId","data-v-88b60beb"]]);export{Re as default};
