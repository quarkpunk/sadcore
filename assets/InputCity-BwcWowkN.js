import{_ as Ie,G as N,r as S,H as be,E as Oe,c as F,d as I,f as Me,F as Pe,h as Ce,Z as fe,x as Fe,i as we,g as Y,j as Le,C as Se,n as ke,y as je,M as _e,m as Ve,v as We}from"./main-CB9hqM7U.js";import{I as he}from"./Image-fGpf9Yrn.js";import{I as Xe}from"./InputModal-BZnAEElk.js";/*!
 * Compressor.js v1.2.1
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-02-28T14:09:41.732Z
 */function me(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);e&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,a)}return t}function j(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?me(Object(t),!0).forEach(function(a){Ye(r,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):me(Object(t)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(t,a))})}return r}function ze(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function ve(r,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r,Be(a.key),a)}}function He(r,e,t){return e&&ve(r.prototype,e),t&&ve(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function Ye(r,e,t){return e=Be(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function _(){return _=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},_.apply(this,arguments)}function Ge(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var a=t.call(r,e);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function Be(r){var e=Ge(r,"string");return typeof e=="symbol"?e:String(e)}var Te={exports:{}};(function(r){typeof window>"u"||(function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,a=e.Blob&&(function(){try{return!!new Blob}catch{return!1}})(),i=a&&e.Uint8Array&&(function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}})(),n=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,v=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,m=(a||n)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(f){var h,g,y,B,d,o,T,w,x;if(h=f.match(v),!h)throw new Error("invalid data URI");for(g=h[2]?h[1]:"text/plain"+(h[3]||";charset=US-ASCII"),y=!!h[4],B=f.slice(h[0].length),y?d=atob(B):d=decodeURIComponent(B),o=new ArrayBuffer(d.length),T=new Uint8Array(o),w=0;w<d.length;w+=1)T[w]=d.charCodeAt(w);return a?new Blob([i?T:o],{type:g}):(x=new n,x.append(o),x.getBlob(g))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(f,h,g){var y=this;setTimeout(function(){g&&t.toDataURL&&m?f(m(y.toDataURL(h,g))):f(y.mozGetAsFile("blob",h))})}:t.toDataURL&&m&&(t.msToBlob?t.toBlob=function(f,h,g){var y=this;setTimeout(function(){(h&&h!=="image/png"||g)&&t.toDataURL&&m?f(m(y.toDataURL(h,g))):f(y.msToBlob(h))})}:t.toBlob=function(f,h,g){var y=this;setTimeout(function(){f(m(y.toDataURL(h,g)))})})),r.exports?r.exports=m:e.dataURLtoBlob=m})(window)})(Te);var de=Te.exports,Ne=function(e){return typeof Blob>"u"?!1:e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"},ge={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},$e=typeof window<"u"&&typeof window.document<"u",E=$e?window:{},V=function(e){return e>0&&e<1/0},qe=Array.prototype.slice;function q(r){return Array.from?Array.from(r):qe.call(r)}var Ke=/^image\/.+$/;function $(r){return Ke.test(r)}function Je(r){var e=$(r)?r.substr(6):"";return e==="jpeg"&&(e="jpg"),".".concat(e)}var xe=String.fromCharCode;function Ze(r,e,t){var a="",i;for(t+=e,i=e;i<t;i+=1)a+=xe(r.getUint8(i));return a}var Qe=E.btoa;function pe(r,e){for(var t=[],a=8192,i=new Uint8Array(r);i.length>0;)t.push(xe.apply(null,q(i.subarray(0,a)))),i=i.subarray(a);return"data:".concat(e,";base64,").concat(Qe(t.join("")))}function et(r){var e=new DataView(r),t;try{var a,i,n;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var v=e.byteLength,m=2;m+1<v;){if(e.getUint8(m)===255&&e.getUint8(m+1)===225){i=m;break}m+=1}if(i){var f=i+4,h=i+10;if(Ze(e,f,4)==="Exif"){var g=e.getUint16(h);if(a=g===18761,(a||g===19789)&&e.getUint16(h+2,a)===42){var y=e.getUint32(h+4,a);y>=8&&(n=h+y)}}}if(n){var B=e.getUint16(n,a),d,o;for(o=0;o<B;o+=1)if(d=n+o*12+2,e.getUint16(d,a)===274){d+=8,t=e.getUint16(d,a),e.setUint16(d,1,a);break}}}catch{t=1}return t}function tt(r){var e=0,t=1,a=1;switch(r){case 2:t=-1;break;case 3:e=-180;break;case 4:a=-1;break;case 5:e=90,a=-1;break;case 6:e=90;break;case 7:e=90,t=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:t,scaleY:a}}var at=/\.\d*(?:0|9){12}\d*$/;function ye(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return at.test(r)?Math.round(r*e)/e:r}function L(r){var e=r.aspectRatio,t=r.height,a=r.width,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",n=V(a),v=V(t);if(n&&v){var m=t*e;(i==="contain"||i==="none")&&m>a||i==="cover"&&m<a?t=a/e:a=t*e}else n?t=a/e:v&&(a=t*e);return{width:a,height:t}}function rt(r){for(var e=q(new Uint8Array(r)),t=e.length,a=[],i=0;i+3<t;){var n=e[i],v=e[i+1];if(n===255&&v===218)break;if(n===255&&v===216)i+=2;else{var m=e[i+2]*256+e[i+3],f=i+m+2,h=e.slice(i,f);a.push(h),i=f}}return a.reduce(function(g,y){return y[0]===255&&y[1]===225?g.concat(y):g},[])}function it(r,e){var t=q(new Uint8Array(r));if(t[2]!==255||t[3]!==224)return r;var a=t[4]*256+t[5],i=[255,216].concat(e,t.slice(4+a));return new Uint8Array(i)}var nt=E.ArrayBuffer,G=E.FileReader,A=E.URL||E.webkitURL,ot=/\.\w+$/,lt=E.Compressor,De=(function(){function r(e,t){ze(this,r),this.file=e,this.exif=[],this.image=new Image,this.options=j(j({},ge),t),this.aborted=!1,this.result=null,this.init()}return He(r,[{key:"init",value:function(){var t=this,a=this.file,i=this.options;if(!Ne(a)){this.fail(new Error("The first argument must be a File or Blob object."));return}var n=a.type;if(!$(n)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!A||!G){this.fail(new Error("The current browser does not support image compression."));return}nt||(i.checkOrientation=!1,i.retainExif=!1);var v=n==="image/jpeg",m=v&&i.checkOrientation,f=v&&i.retainExif;if(A&&!m&&!f)this.load({url:A.createObjectURL(a)});else{var h=new G;this.reader=h,h.onload=function(g){var y=g.target,B=y.result,d={},o=1;m&&(o=et(B),o>1&&_(d,tt(o))),f&&(t.exif=rt(B)),m||f?!A||o>1?d.url=pe(B,n):d.url=A.createObjectURL(a):d.url=B,t.load(d)},h.onabort=function(){t.fail(new Error("Aborted to read the image with FileReader."))},h.onerror=function(){t.fail(new Error("Failed to read the image with FileReader."))},h.onloadend=function(){t.reader=null},m||f?h.readAsArrayBuffer(a):h.readAsDataURL(a)}}},{key:"load",value:function(t){var a=this,i=this.file,n=this.image;n.onload=function(){a.draw(j(j({},t),{},{naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight}))},n.onabort=function(){a.fail(new Error("Aborted to load the image."))},n.onerror=function(){a.fail(new Error("Failed to load the image."))},E.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(E.navigator.userAgent)&&(n.crossOrigin="anonymous"),n.alt=i.name,n.src=t.url}},{key:"draw",value:function(t){var a=this,i=t.naturalWidth,n=t.naturalHeight,v=t.rotate,m=v===void 0?0:v,f=t.scaleX,h=f===void 0?1:f,g=t.scaleY,y=g===void 0?1:g,B=this.file,d=this.image,o=this.options,T=document.createElement("canvas"),w=T.getContext("2d"),x=Math.abs(m)%180===90,M=(o.resize==="contain"||o.resize==="cover")&&V(o.width)&&V(o.height),D=Math.max(o.maxWidth,0)||1/0,R=Math.max(o.maxHeight,0)||1/0,U=Math.max(o.minWidth,0)||0,l=Math.max(o.minHeight,0)||0,u=i/n,c=o.width,s=o.height;if(x){var b=[R,D];D=b[0],R=b[1];var p=[l,U];U=p[0],l=p[1];var k=[s,c];c=k[0],s=k[1]}M&&(u=c/s);var K=L({aspectRatio:u,width:D,height:R},"contain");D=K.width,R=K.height;var J=L({aspectRatio:u,width:U,height:l},"cover");if(U=J.width,l=J.height,M){var Z=L({aspectRatio:u,width:c,height:s},o.resize);c=Z.width,s=Z.height}else{var Q=L({aspectRatio:u,width:c,height:s}),ee=Q.width;c=ee===void 0?i:ee;var te=Q.height;s=te===void 0?n:te}c=Math.floor(ye(Math.min(Math.max(c,U),D))),s=Math.floor(ye(Math.min(Math.max(s,l),R)));var Re=-c/2,Ee=-s/2,Ue=c,Ae=s,W=[];if(M){var ae=0,re=0,X=i,z=n,ie=L({aspectRatio:u,width:i,height:n},{contain:"cover",cover:"contain"}[o.resize]);X=ie.width,z=ie.height,ae=(i-X)/2,re=(n-z)/2,W.push(ae,re,X,z)}if(W.push(Re,Ee,Ue,Ae),x){var ne=[s,c];c=ne[0],s=ne[1]}T.width=c,T.height=s,$(o.mimeType)||(o.mimeType=B.type);var oe="transparent";B.size>o.convertSize&&o.convertTypes.indexOf(o.mimeType)>=0&&(o.mimeType="image/jpeg");var le=o.mimeType==="image/jpeg";if(le&&(oe="#fff"),w.fillStyle=oe,w.fillRect(0,0,c,s),o.beforeDraw&&o.beforeDraw.call(this,w,T),!this.aborted&&(w.save(),w.translate(c/2,s/2),w.rotate(m*Math.PI/180),w.scale(h,y),w.drawImage.apply(w,[d].concat(W)),w.restore(),o.drew&&o.drew.call(this,w,T),!this.aborted)){var se=function(P){if(!a.aborted){var ue=function(C){return a.done({naturalWidth:i,naturalHeight:n,result:C})};if(P&&le&&o.retainExif&&a.exif&&a.exif.length>0){var ce=function(C){return ue(de(pe(it(C,a.exif),o.mimeType)))};if(P.arrayBuffer)P.arrayBuffer().then(ce).catch(function(){a.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var O=new G;a.reader=O,O.onload=function(H){var C=H.target;ce(C.result)},O.onabort=function(){a.fail(new Error("Aborted to read the compressed image with FileReader."))},O.onerror=function(){a.fail(new Error("Failed to read the compressed image with FileReader."))},O.onloadend=function(){a.reader=null},O.readAsArrayBuffer(P)}}else ue(P)}};T.toBlob?T.toBlob(se,o.mimeType,o.quality):se(de(T.toDataURL(o.mimeType,o.quality)))}}},{key:"done",value:function(t){var a=t.naturalWidth,i=t.naturalHeight,n=t.result,v=this.file,m=this.image,f=this.options;if(A&&m.src.indexOf("blob:")===0&&A.revokeObjectURL(m.src),n)if(f.strict&&!f.retainExif&&n.size>v.size&&f.mimeType===v.type&&!(f.width>a||f.height>i||f.minWidth>a||f.minHeight>i||f.maxWidth<a||f.maxHeight<i))n=v;else{var h=new Date;n.lastModified=h.getTime(),n.lastModifiedDate=h,n.name=v.name,n.name&&n.type!==v.type&&(n.name=n.name.replace(ot,Je(n.type)))}else n=v;this.result=n,f.success&&f.success.call(this,n)}},{key:"fail",value:function(t){var a=this.options;if(a.error)a.error.call(this,t);else throw t}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=lt,r}},{key:"setDefaults",value:function(t){_(ge,t)}}]),r})();function st(r){return new Promise((e,t)=>{if(!r||!r.type.startsWith("image/")){t(new Error("File not image!"));return}new De(r,{resize:"cover",quality:.6,width:960,height:1280,mimeType:"image/jpeg",beforeDraw(a,i){a.fillStyle="#000000",a.fillRect(0,0,i.width,i.height),a.filter="grayscale(100%)"},success:a=>e(a),error:a=>t(a)})})}function ut(r){return new Promise((e,t)=>{if(!r||!r.type.startsWith("image/")){t(new Error("File not image!"));return}new De(r,{resize:"cover",quality:.5,width:128,height:170,mimeType:"image/jpeg",beforeDraw(a,i){a.fillStyle="#000000",a.fillRect(0,0,i.width,i.height),a.filter="grayscale(100%)"},success:a=>e(a),error:a=>t(a)})})}async function ct(r){try{const[e,t]=await Promise.all([ut(r),st(r)]);return{smallImage:e,baseImage:t}}catch(e){return console.error("failed compress image:",e),null}}const ft=["id"],ht=["draggable","onDragstart","onDrop","onMousedown","onTouchstart","onTouchmove","onTouchend"],mt=["onClick"],vt={key:1,class:"empty"},dt=["onChange"],gt=["src"],pt={__name:"Gallery",props:N({disabled:Boolean},{modelValue:{},modelModifiers:{}}),emits:N(["loaded","delete","moved"],["update:modelValue"]),setup(r,{emit:e}){const t=S({show:!1,x:0,y:0,image:null});let a=null;const i=be(r,"modelValue"),n=e,v=r,m=Array(4).fill(null);i.value||(i.value=m),i.value&&i.value.forEach((l,u)=>{u<4&&(m[u]=l)});function f(l){i.value?.[l]&&(i.value[l]._local&&(URL.revokeObjectURL(i.value[l].base),URL.revokeObjectURL(i.value[l].small)),i.value[l]=null,n("delete",l))}async function h(l,u){const c=l.target.files[0];if(c)try{const{smallImage:s,baseImage:b}=await ct(c),p={index:u,id:"",base:URL.createObjectURL(b),small:URL.createObjectURL(s),_local:{base:b,small:s},_state:{success:!1,error:!1}};i.value[u]=p,l.target.value="",n("loaded",u)}catch(s){console.error("Error compressing image:",s)}}function g(l,u){const c=parseInt(l.dataTransfer.getData("itemId"));if(i.value[u]==null){i.value[u]=i.value[c],i.value[u].index=u,i.value[c]=null,n("moved",c,u);return}else{let s=i.value.slice(0);const b=s[c],p=s[u];s[u]=b,s[c]=p,s[u].index=u,s[c].index=c,i.value=s,n("moved",c,u)}}let y=0,B=0,d=null;function o(l,u){const c=l.touches[0],s=document.elementFromPoint(c.clientX,c.clientY);s&&s.closest(".remove")||i.value[u]!==null&&(a=setTimeout(()=>{const b=l.touches[0];if(!b)return;const p=Math.abs(b.clientX-y),k=Math.abs(b.clientY-B);(p>10||k>10)&&(d=u),t.value={show:!0,x:b.clientX,y:b.clientY,image:i.value[u].base}},400),l.preventDefault())}function T(l,u){if(d===null)return;const c=l.touches[0];t.value.x=c.clientX,t.value.y=c.clientY,l.preventDefault()}function w(l,u){if(clearTimeout(a),d===null)return;const c=l.changedTouches[0],s=document.elementFromPoint(c.clientX,c.clientY);if(t.value.show=!1,s&&s.closest(".rect")){const b=s.closest(".rect"),p=Array.from(document.querySelectorAll(".rect")).indexOf(b);p!==-1&&p!==d&&g({dataTransfer:{getData:()=>d.toString()}},p)}d=null,l.preventDefault()}let x=!1;function M(l,u){l.target.closest(".remove")||i.value[u]!==null&&(x=!0,d=u,l.clientX,l.clientY,t.value={show:!0,x:l.clientX,y:l.clientY,image:i.value[u].base},document.addEventListener("mousemove",D),document.addEventListener("mouseup",R),l.preventDefault())}function D(l){x&&(t.value.x=l.clientX,t.value.y=l.clientY)}function R(l){if(!x)return;x=!1,t.value.show=!1;const u=document.elementFromPoint(l.clientX,l.clientY);if(u&&u.closest(".rect")){const c=u.closest(".rect"),s=Array.from(document.querySelectorAll(".rect")).indexOf(c);s!==-1&&s!==d&&g({dataTransfer:{getData:()=>d.toString()}},s)}document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",R),d=null}function U(l,u){if(l.dataTransfer.setData("itemId",u),l.dataTransfer.setDragImage){const c=new he;c.src=i.value[u].base,l.dataTransfer.setDragImage(c,0,0)}}return(l,u)=>{const c=Oe("Icon-Add");return I(),F("div",{class:ke(["gallery",{disabled:v.disabled}]),id:v.disabled?"noevents":null},[(I(!0),F(Pe,null,Ce(i.value,(s,b)=>(I(),F("div",{key:s,class:"rect",draggable:i.value[b]!=null,onDragstart:p=>U(p,b),onDragover:u[0]||(u[0]=fe(()=>{},["prevent"])),onDrop:p=>g(p,b),onMousedown:p=>M(p,b),onTouchstart:p=>o(p,b),onTouchmove:fe(p=>T(p),["prevent"]),onTouchend:p=>w(p)},[Fe(Y("div",{class:"remove",onClick:p=>f(b)},null,8,mt),[[je,s]]),s?(I(),we(he,{key:0,blur:"",src:s.base,placeholder:s.small,id:"noevents",style:{position:"absolute",width:"100%",height:"100%","border-radius":"15px"},cover:""},null,8,["src","placeholder"])):(I(),F("div",vt,[Le(c,{color:"var(--color-gray-400)",style:{margin:"auto"},width:22,height:22}),Y("input",{class:"loader",type:"file",onChange:p=>h(p,b),accept:"image/png, image/jpeg"},null,40,dt)]))],40,ht))),128)),t.value.show?(I(),F("div",{key:0,class:"drag-preview",style:Se({left:t.value.x+"px",top:t.value.y+"px"})},[Y("img",{src:t.value.image,alt:"Preview"},null,8,gt)],4)):Me("",!0)],10,ft)}}},Tt=Ie(pt,[["__scopeId","data-v-dcd88a80"]]),xt={__name:"InputCity",props:N({textValue:String,textNotValue:{type:String,default:"Укажите город"},showButtonDelete:{type:Boolean,value:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const e=be(r,"modelValue"),t=r,a=_e(),i=Ve(),n=S(!1),v=S(""),m=S([]),f=S(null),h=We({get:()=>v.value,set:o=>{v.value=o,n.value=!1,clearTimeout(f.value),n.value=!0,f.value=setTimeout(g,1e3)}});async function g(){if(v.value.length<2)return;const o=await i.fetchCity(v.value);m.value=o,n.value=!1,clearTimeout(f.value)}function y(o){o&&(e.value={id:o._id,name:o.name,code:o.code},v.value="")}function B(o){e.value!=null&&(e.value=null,v.value="")}const d=()=>{a.open("city",{modelValue:h,values:m,loading:n,showButtonDelete:t.showButtonDelete},{accept:y,cancel:B})};return(o,T)=>(I(),we(Xe,{placeholder:"Не указано",text:e.value&&t.textValue?t.textValue:t.textNotValue,value:e.value?e.value.name:null,onClick:d},null,8,["text","value"]))}};export{Tt as G,xt as _};
